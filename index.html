<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dodger Racing ‚Äî Kid Edition</title>
  <style>
    :root { --bg:#0b1221; --text:#e8f0ff; }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif; }
    .wrap { display:flex; flex-direction:column; align-items:center; gap:8px; padding:16px; }
    h1 { margin:10px 0 0; font-size:20px; font-weight:700; letter-spacing:.3px; }
    canvas { background:linear-gradient(#0d1326, #0b1221); border:2px solid #1f2b54; border-radius:12px; touch-action:none; }
    .hud { display:flex; gap:16px; align-items:center; font-weight:600; flex-wrap:wrap; justify-content:center; }
    .btns { display:flex; gap:10px; }
    button { background:#1b274d; color:var(--text); border:1px solid #2a3972; padding:8px 12px; border-radius:10px; cursor:pointer; }
    button:hover { background:#223064; }
    .mobile { display:none; gap:12px; }
    .mctl { width:70px; height:70px; background:#1b274d; border:1px solid #2a3972; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; user-select:none; }
    @media (max-width: 640px) {
      canvas { width:300px; height:500px; }
      .mobile { display:flex; }
    }
    .tips { font-size:12px; opacity:.85; text-align:center; max-width:620px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üöó Dodger Racing ‚Äî Kid Edition</h1>
    <div class="hud">
      <div>Score: <span id="score">0</span></div>
      <div>Best: <span id="best">0</span></div>
      <div>Speed: <span id="spd">1.0x</span></div>
      <div class="btns">
        <button id="restart">Restart</button>
      </div>
    </div>
    <canvas id="game" width="360" height="600" aria-label="Racing game"></canvas>
    <div class="mobile">
      <div class="mctl" id="left">‚üµ</div>
      <div class="mctl" id="boost">‚ö°</div>
      <div class="mctl" id="right">‚ü∂</div>
    </div>
    <div class="tips">
      Controls: ‚Üê ‚Üí to move, hold <b>Shift</b> (or tap ‚ö°) to boost. Avoid red obstacles. Survive to score!<br/>
      <b>Note:</b> Place your kid photo as <code>kid.jpg</code> in the same folder as this file.
    </div>
  </div>

  <script>
    // --- Canvas & UI
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    const scoreEl = document.getElementById('score');
    const bestEl  = document.getElementById('best');
    const spdEl   = document.getElementById('spd');
    const restartBtn = document.getElementById('restart');

    const W = cvs.width, H = cvs.height;
    const laneCount = 3;
    const laneW = W / laneCount;

    // --- Game State
    const state = {
      running: true,
      t: 0,
      speed: 3,
      boost: false,
      score: 0,
      best: parseInt(localStorage.getItem('dr_best')||'0',10),
      obstacles: [],
      linesY: 0
    };
    bestEl.textContent = state.best;

    // --- Player
    const car = {
      lane: 1,
      x: laneW*1 + laneW/2,
      y: H - 100,
      w: 52,
      h: 84
    };

    // --- Load kid photo (must exist as kid.jpg in same folder)
    const kidImg = new Image();
    kidImg.src = 'kid.jpg';
    let kidReady = false;
    kidImg.onload = () => kidReady = true;

    // --- Input
    const keys = {};
    addEventListener('keydown', e => {
      keys[e.key] = true;
      if (e.key === 'ArrowLeft')  moveLane(-1);
      if (e.key === 'ArrowRight') moveLane(+1);
      if (e.key === 'Shift') state.boost = true;
      if (!state.running && (e.key === 'Enter' || e.key === ' ')) reset();
    });
    addEventListener('keyup', e => {
      keys[e.key] = false;
      if (e.key === 'Shift') state.boost = false;
    });

    document.getElementById('left').addEventListener('touchstart', () => moveLane(-1));
    document.getElementById('right').addEventListener('touchstart', () => moveLane(+1));
    document.getElementById('boost').addEventListener('touchstart', () => state.boost = true);
    document.getElementById('boost').addEventListener('touchend', () => state.boost = false);
    restartBtn.onclick = reset;

    function moveLane(dir){
      if (!state.running) return;
      car.lane = Math.max(0, Math.min(laneCount-1, car.lane + dir));
      car.x = car.lane*laneW + laneW/2;
    }

    // --- Obstacles
    function spawnObstacle(){
      const lane = Math.floor(Math.random()*laneCount);
      state.obstacles.push({
        lane,
        x: lane*laneW + laneW/2,
        y: -90,
        w: 50,
        h: 80
      });
    }

    // --- Loop
    let last = 0;
    function loop(ts){
      const dt = (ts - last) / 16.6667; // ~frames
      last = ts;
      if (state.running) update(dt);
      draw();
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    function update(dt){
      state.t += dt;
      const baseSpeed = state.speed * (state.boost ? 1.7 : 1.0);
      spdEl.textContent = (state.boost ? (state.speed*1.7).toFixed(1) : state.speed.toFixed(1)) + 'x';

      // Lane lines
      state.linesY = (state.linesY + baseSpeed*4) % 40;

      // Spawn obstacles
      if (state.t > 30 / baseSpeed) {
        state.t = 0;
        spawnObstacle();
        state.speed = Math.min(7, state.speed + 0.02);
      }

      // Move obstacles
      for (const o of state.obstacles) o.y += baseSpeed * 3.2;

      // Remove passed + score
      state.obstacles = state.obstacles.filter(o=>{
        if (o.y > H+100) {
          state.score++;
          scoreEl.textContent = state.score;
          return false;
        }
        return true;
      });

      // Collision
      for (const o of state.obstacles) {
        if (intersect(car, o)) { gameOver(); break; }
      }
    }

    // --- Rendering
    function draw(){
      // Background road
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = '#0b1221';
      ctx.fillRect(0,0,W,H);

      // Lane borders
      for (let i=1;i<laneCount;i++){
        ctx.fillStyle = '#1a2447';
        ctx.fillRect(i*laneW-2,0,4,H);
      }

      // Dotted center per lane
      ctx.strokeStyle = '#2a3972';
      ctx.lineWidth = 4;
      for (let lane=0; lane<laneCount; lane++){
        const cx = lane*laneW + laneW/2;
        ctx.setLineDash([18,18]);
        ctx.beginPath();
        ctx.moveTo(cx, -40 + state.linesY);
        ctx.lineTo(cx, H + 40 + state.linesY);
        ctx.stroke();
      }
      ctx.setLineDash([]);

      // Player SUV (with kid in window)
      drawPlayerCar(car.x, car.y, car.w, car.h);

      // Obstacles
      for (const o of state.obstacles) drawObstacleCar(o.x, o.y, o.w, o.h);

      // Game Over overlay
      if (!state.running){
        ctx.fillStyle = 'rgba(0,0,0,.55)';
        ctx.fillRect(0,0,W,H);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.font = 'bold 28px system-ui';
        ctx.fillText('Game Over', W/2, H/2 - 10);
        ctx.font = '16px system-ui';
        ctx.fillText('Press Enter or click Restart', W/2, H/2 + 20);
      }
    }

    function drawPlayerCar(x,y,w,h){
      // black SUV body (Nexon-like, no branding)
      drawSUV(x, y, w, h, '#121212', '#1f1f1f');

      // windshield where kid shows
      const winX = x;
      const winY = y - h*0.17;
      const winW = w * 0.78;
      const winH = h * 0.40;
      roundRect(winX - winW/2, winY - winH/2, winW, winH, 10, 'rgba(255,255,255,0.22)');

      // kid portrait clipped to a circle in the windshield
      if (kidReady){
        ctx.save();
        const clipR = Math.min(winW, winH) * 0.42;
        ctx.beginPath();
        ctx.arc(winX, winY, clipR, 0, Math.PI*2);
        ctx.closePath();
        ctx.clip();

        const iw = kidImg.width, ih = kidImg.height;
        const side = Math.min(iw, ih);
        const sx = (iw - side)/2;
        const sy = (ih - side)/2;
        const d = clipR*2;
        ctx.drawImage(kidImg, sx, sy, side, side, winX - d/2, winY - d/2, d, d);
        ctx.restore();

        ctx.strokeStyle = 'rgba(255,255,255,0.35)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(winX, winY, clipR, 0, Math.PI*2);
        ctx.stroke();
      }
    }

    function drawObstacleCar(x,y,w,h){
      drawSUV(x, y, w, h, '#cc2b2b', '#b22222'); // red sedan-like
      roundRect(x - w*0.35, y - h*0.30, w*0.70, h*0.25, 8, 'rgba(255,255,255,0.2)');
    }

    function drawSUV(cx, cy, w, h, body='#121212', shadow='#1f1f1f'){
      ctx.save();
      ctx.translate(cx, cy);

      // main body
      roundRect(-w/2, -h/2, w, h, 12, body);

      // roof
      roundRect(-w*0.38, -h*0.38, w*0.76, h*0.22, 10, shadow);

      // bumpers
      roundRect(-w/2, -h/2, w, h*0.08, 6, '#0a0a0a');
      roundRect(-w/2,  h/2 - h*0.08, w, h*0.08, 6, '#0a0a0a');

      // wheels
      ctx.fillStyle = '#0d0d0d';
      const wheelW = 8, wheelH = 20;
      ctx.fillRect(-w/2-6, -h/2+12, wheelW, wheelH);
      ctx.fillRect( w/2-2, -h/2+12, wheelW, wheelH);
      ctx.fillRect(-w/2-6,  h/2-32, wheelW, wheelH);
      ctx.fillRect( w/2-2,  h/2-32, wheelW, wheelH);

      // side line
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(-w/2+6, 0, w-12, 3);

      // lights
      ctx.fillStyle = '#ffd777';
      ctx.fillRect(-w*0.22, -h/2+4, w*0.18, 5);
      ctx.fillRect( w*0.04, -h/2+4, w*0.18, 5);
      ctx.fillStyle = '#ff5858';
      ctx.fillRect(-w*0.22,  h/2-9, w*0.18, 5);
      ctx.fillRect( w*0.04,  h/2-9, w*0.18, 5);

      ctx.restore();
    }

    // --- Helpers
    function roundRect(x,y,w,h,r,fill){
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath();
      ctx.fillStyle = fill;
      ctx.fill();
    }

    function intersect(a,b){
      const ax = a.x - a.w/2, ay = a.y - a.h/2;
      const bx = b.x - b.w/2, by = b.y - b.h/2;
      return ax < bx + b.w && ax + a.w > bx && ay < by + b.h && ay + a.h > by;
    }

    function gameOver(){
      state.running = false;
      if (state.score > state.best){
        state.best = state.score;
        localStorage.setItem('dr_best', String(state.best));
        bestEl.textContent = state.best;
      }
    }

    function reset(){
      state.running = true;
      state.t = 0;
      state.speed = 3;
      state.boost = false;
      state.score = 0;
      scoreEl.textContent = '0';
      state.obstacles = [];
      car.lane = 1;
      car.x = laneW*1 + laneW/2;
    }
  </script>
</body>
</html>
